<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Complaint Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .modal-backdrop {
            background-color: rgba(0,0,0,0.5);
        }
        .modal {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-weight: 500;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .status-pending {
            background-color: #FEF3C7; /* yellow-200 */
            color: #92400E; /* yellow-800 */
        }
        .status-in-progress {
            background-color: #DBEAFE; /* blue-200 */
            color: #1E40AF; /* blue-800 */
        }
        .status-resolved {
            background-color: #D1FAE5; /* green-200 */
            color: #065F46; /* green-800 */
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div id="app" class="min-h-screen flex flex-col items-center justify-center p-4">

    <div id="loginView" class="w-full max-w-sm">
    <div class="bg-white shadow-xl rounded-2xl p-8">
        <form id="loginForm">
            <h1 class="text-2xl font-bold text-center mb-2">Login</h1>
            <p class="text-gray-500 text-center mb-8">Enter your credentials.</p>
            <div class="space-y-4">
                <input id="loginUsername" type="text" placeholder="Username" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <input id="loginPassword" type="password" placeholder="Password" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <p id="loginError" class="text-red-500 text-sm text-center hidden">Invalid username or password.</p>
                <button type="submit" class="w-full bg-blue-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors duration-300 shadow-md">Login</button>
            </div>
        </form>
        <p class="text-center text-sm text-gray-500 mt-4">
            Don't have an account? 
            <button onclick="toggleToRegister()" class="font-semibold text-blue-600 hover:underline">Register</button>
        </p>
    </div>
    <p class="text-center text-gray-400 text-sm mt-6">Project by Hemant Dubey & Chirag Soni</p>
</div>

<div id="registerView" class="hidden w-full max-w-sm">
    <div class="bg-white shadow-xl rounded-2xl p-8">
        <form id="registerForm">
            <h1 class="text-2xl font-bold text-center mb-2">Register</h1>
            <p class="text-gray-500 text-center mb-8">Create a new account.</p>
            <div class="space-y-4">
                <input id="registerUsername" type="text" placeholder="Username" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <input id="registerPassword" type="password" placeholder="Password" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <p id="registerError" class="text-red-500 text-sm text-center hidden"></p>
                <button type="submit" class="w-full bg-green-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-green-700 transition-colors duration-300 shadow-md">Create Account</button>
            </div>
        </form>
         <p class="text-center text-sm text-gray-500 mt-4">
            Already have an account? 
            <button onclick="toggleToLogin()" class="font-semibold text-blue-600 hover:underline">Login</button>
        </p>
    </div>
</div>

    <div id="complaintModal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden">
        <div id="modalContent" class="bg-white rounded-2xl shadow-xl w-full max-w-md p-8 transform scale-95 opacity-0 modal">
            <h2 class="text-2xl font-bold mb-6">Register New Complaint</h2>
            <form id="complaintForm">
                <div class="mb-4">
                    <label for="category" class="block text-sm font-medium text-gray-700 mb-2">Category</label>
                    <select id="category" name="category" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="Electricity">Electricity</option>
                        <option value="Water">Water Supply</option>
                        <option value="Maintenance">Maintenance</option>
                        <option value="Internet">Internet/Wi-Fi</option>
                        <option value="Security">Security</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="mb-6">
                    <label for="description" class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                    <textarea id="description" name="description" rows="4" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Please provide details about the issue..."></textarea>
                </div>
                <div class="flex justify-end space-x-4">
                    <button type="button" onclick="closeComplaintModal()" class="bg-gray-200 text-gray-700 font-semibold py-2 px-5 rounded-lg hover:bg-gray-300 transition-colors">Cancel</button>
                    <button type="submit" class="bg-blue-600 text-white font-semibold py-2 px-5 rounded-lg hover:bg-blue-700 transition-colors">Submit</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // --- Get new DOM elements ---
const loginForm = document.getElementById('loginForm');
const registerView = document.getElementById('registerView');
const registerForm = document.getElementById('registerForm');
const loginError = document.getElementById('loginError');
const registerError = document.getElementById('registerError');


// --- View Toggling ---
function toggleToRegister() {
    loginView.classList.add('hidden');
    registerView.classList.remove('hidden');
    loginError.classList.add('hidden');
}

function toggleToLogin() {
    registerView.classList.add('hidden');
    loginView.classList.remove('hidden');
    registerError.classList.add('hidden');
}


// --- Event Listeners for Forms ---
loginForm.addEventListener('submit', function(e) {
    e.preventDefault();
    const username = document.getElementById('loginUsername').value;
    const password = document.getElementById('loginPassword').value;

    // Check if the user is the admin
    if (username === 'admin' && password === 'password') { // Simple admin check
        currentUser = { username: 'admin' };
        loginView.classList.add('hidden');
        adminView.classList.remove('hidden');
        loginError.classList.add('hidden');
        renderAll();
        return;
    }

    // Find a regular user
    const user = users.find(u => u.username === username && u.password === password);
    
    if (user) {
        currentUser = user;
        loginView.classList.add('hidden');
        userView.classList.remove('hidden');
        loginError.classList.add('hidden');
        renderAll();
    } else {
        loginError.classList.remove('hidden');
    }
});

registerForm.addEventListener('submit', function(e) {
    e.preventDefault();
    const username = document.getElementById('registerUsername').value;
    const password = document.getElementById('registerPassword').value;
    
    // Check if username already exists
    if (users.some(u => u.username === username)) {
        registerError.textContent = 'Username already taken.';
        registerError.classList.remove('hidden');
        return;
    }

    // Add new user
    users.push({ username, password });
    saveToStorage();
    alert('Registration successful! Please login.');
    toggleToLogin();
    registerForm.reset();
});

// Update the handleLogout function
function handleLogout() {
    currentUser = null;
    userView.classList.add('hidden');
    adminView.classList.add('hidden');
    
    // Check if register view is visible and hide it
    if (!registerView.classList.contains('hidden')) {
        registerView.classList.add('hidden');
    }

    loginView.classList.remove('hidden');
    document.getElementById('loginForm').reset();
}

// **Important Security Note:** Storing plain text passwords is very insecure. In a real application, you would **hash** the passwords before saving them. This is a simplified example for demonstration.
        // --- DOM Elements ---
        const loginView = document.getElementById('loginView');
        const userView = document.getElementById('userView');
        const adminView = document.getElementById('adminView');
        const userComplaintsContainer = document.getElementById('userComplaints');
        const adminComplaintsContainer = document.getElementById('adminComplaints');
        const complaintModal = document.getElementById('complaintModal');
        const modalContent = document.getElementById('modalContent');
        const complaintForm = document.getElementById('complaintForm');
        

       // --- Application State ---
let complaints = [];
let users = []; // Array to hold user objects {username, password}
let currentUser = null; // To track who is logged in
let nextId = 1;

        // --- Sample Data ---
        function loadSampleData() {
            complaints = [
                { id: nextId++, user: 'user1', category: 'Electricity', description: 'Power outage in Room 201 since morning.', status: 'Pending', date: '2024-07-28' },
                { id: nextId++, user: 'user2', category: 'Water', description: 'No water in the 3rd-floor washroom.', status: 'In-Progress', date: '2024-07-27' },
                { id: nextId++, user: 'user1', category: 'Maintenance', description: 'The window pane in the common area is broken.', status: 'Resolved', date: '2024-07-25' },
                { id: nextId++, user: 'user3', category: 'Internet', description: 'Wi-Fi is very slow on the entire 2nd floor.', status: 'Pending', date: '2024-07-28' },
            ];
            renderAll();
        }
// --- Data Persistence Functions ---
function saveToStorage() {
    localStorage.setItem('complaintSystem_users', JSON.stringify(users));
    localStorage.setItem('complaintSystem_complaints', JSON.stringify(complaints));
    localStorage.setItem('complaintSystem_nextId', nextId);
}

function loadFromStorage() {
    // Load users or create a default admin user if none exist
    const storedUsers = localStorage.getItem('complaintSystem_users');
    if (storedUsers) {
        users = JSON.parse(storedUsers);
    } else {
        // Add a default admin user if no users are stored
        users = [{ username: 'admin', password: 'password' }];
    }

    // Load complaints
    const storedComplaints = localStorage.getItem('complaintSystem_complaints');
    complaints = storedComplaints ? JSON.parse(storedComplaints) : [];

    // Load the next ID
    const storedNextId = localStorage.getItem('complaintSystem_nextId');
    nextId = storedNextId ? parseInt(storedNextId) : complaints.length + 1;
}
        // --- Status Styling Helper ---
        function getStatusClass(status) {
            switch (status) {
                case 'Pending': return 'status-pending';
                case 'In-Progress': return 'status-in-progress';
                case 'Resolved': return 'status-resolved';
                default: return 'bg-gray-200 text-gray-800';
            }
        }
// --- Modified Render Function ---
function renderUserComplaints() {
    if (!currentUser) return; // Don't render if nobody is logged in

    const currentUserComplaints = complaints.filter(c => c.user === currentUser.username).sort((a, b) => b.id - a.id);
    
    if (currentUserComplaints.length === 0) {
        userComplaintsContainer.innerHTML = `<div class="bg-white text-center p-12 rounded-2xl shadow-md"><p class="text-gray-500">You have not submitted any complaints yet.</p></div>`;
        return;
    }
    // ... the rest of the function is the same
    userComplaintsContainer.innerHTML = currentUserComplaints.map(c => `...`).join('');
}


// --- Modified Complaint Submission ---
complaintForm.addEventListener('submit', function(e) {
    e.preventDefault();
    if (!currentUser) {
        alert("You must be logged in to submit a complaint.");
        return;
    }
    
    const newComplaint = {
        id: nextId++,
        user: currentUser.username, // Use the logged-in user's name
        category: e.target.category.value,
        description: e.target.description.value,
        status: 'Pending',
        date: new Date().toISOString().split('T')[0]
    };
    complaints.push(newComplaint);
    saveToStorage(); // Save the new complaint
    renderAll();
    closeComplaintModal();
});
        

        function renderAdminComplaints() {
            const sortedComplaints = [...complaints].sort((a, b) => b.id - a.id);
            if (sortedComplaints.length === 0) {
                adminComplaintsContainer.innerHTML = `<div class="bg-white text-center p-12 rounded-2xl shadow-md col-span-full"><p class="text-gray-500">No complaints have been submitted yet.</p></div>`;
                return;
            }
            adminComplaintsContainer.innerHTML = sortedComplaints.map(c => `
                <div class="bg-white shadow-lg rounded-2xl p-6 flex flex-col justify-between">
                    <div>
                        <div class="flex justify-between items-start mb-2">
                            <span class="font-bold text-lg text-blue-600">${c.category}</span>
                            <span class="status-badge ${getStatusClass(c.status)}">${c.status}</span>
                        </div>
                        <p class="text-gray-700 mb-3">${c.description}</p>
                    </div>
                    <div>
                        <div class="text-sm text-gray-500 mb-4">
                            <p>ID: C${String(c.id).padStart(4, '0')}</p>
                            <p>User: ${c.user}</p>
                            <p>Date: ${c.date}</p>
                        </div>
                        <div class="flex items-center justify-between bg-gray-50 p-2 rounded-lg">
                            <label for="status-select-${c.id}" class="text-sm font-medium mr-2">Update Status:</label>
                            <select id="status-select-${c.id}" onchange="updateStatus(${c.id}, this.value)" class="border-gray-300 rounded-md shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50 text-sm">
                                <option value="Pending" ${c.status === 'Pending' ? 'selected' : ''}>Pending</option>
                                <option value="In-Progress" ${c.status === 'In-Progress' ? 'selected' : ''}>In-Progress</option>
                                <option value="Resolved" ${c.status === 'Resolved' ? 'selected' : ''}>Resolved</option>
                            </select>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function renderAll() {
            renderUserComplaints();
            renderAdminComplaints();
        }

        // --- Event Handlers & Logic ---
        function handleLogin(role) {
            loginView.classList.add('hidden');
            if (role === 'user') {
                userView.classList.remove('hidden');
            } else {
                adminView.classList.remove('hidden');
            }
        }

        function handleLogout() {
            userView.classList.add('hidden');
            adminView.classList.add('hidden');
            loginView.classList.remove('hidden');
        }

        function openComplaintModal() {
            complaintModal.classList.remove('hidden');
            setTimeout(() => {
                modalContent.classList.remove('scale-95', 'opacity-0');
                modalContent.classList.add('scale-100', 'opacity-100');
            }, 10);
        }

        function closeComplaintModal() {
             modalContent.classList.remove('scale-100', 'opacity-100');
             modalContent.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                 complaintModal.classList.add('hidden');
                 complaintForm.reset();
            }, 300);
        }

        complaintForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const newComplaint = {
                id: nextId++,
                user: 'user1', // Hardcoded for demo
                category: e.target.category.value,
                description: e.target.description.value,
                status: 'Pending',
                date: new Date().toISOString().split('T')[0]
            };
            complaints.push(newComplaint);
            renderAll();
            closeComplaintModal();
        });

        function updateStatus(id, newStatus) {
            const complaint = complaints.find(c => c.id === id);
            if (complaint) {
                complaint.status = newStatus;
                renderAll();
            }
        }

        // --- Initial Load ---
window.onload = () => {
    loadFromStorage();
    // No need to call renderAll() here, as it's called after login
};
    </script>
</body>
</html>